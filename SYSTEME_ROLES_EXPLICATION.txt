================================================================================
                    SYSTÃˆME DE GESTION DES RÃ”LES - APPLICATION SUIVI
================================================================================

ğŸ“‹ TABLE DES MATIÃˆRES
1. HiÃ©rarchie des RÃ´les
2. Permissions par RÃ´le
3. Fichiers de Configuration
4. Utilisation dans les Templates
5. ContrÃ´le d'AccÃ¨s dans les ContrÃ´leurs
6. Comment Ajouter un Nouveau RÃ´le
7. Exemples Pratiques

================================================================================
1. HIÃ‰RARCHIE DES RÃ”LES
================================================================================

ROLE_USER (Base)
    â†“
ROLE_EDITEUR (HÃ©rite de ROLE_USER)
    â†“
ROLE_DIRECTEUR (HÃ©rite de ROLE_EDITEUR + ROLE_USER)
    â†“
ROLE_ADMIN (HÃ©rite de tous les autres rÃ´les)

Configuration dans: config/packages/security.yaml
```yaml
role_hierarchy:
    ROLE_EDITEUR: ROLE_USER
    ROLE_DIRECTEUR: ROLE_EDITEUR
    ROLE_ADMIN: ROLE_DIRECTEUR
```

================================================================================
2. PERMISSIONS PAR RÃ”LE
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MATRICE DES PERMISSIONS                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Action                    â”‚ USER â”‚ EDITEUR â”‚ DIRECTEUR â”‚ ADMIN â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ AccÃ¨s de base             â”‚  âœ…  â”‚   âœ…    â”‚    âœ…     â”‚  âœ…   â”‚
â”‚ CrÃ©er formations/missions â”‚  âŒ  â”‚   âœ…    â”‚    âŒ     â”‚  âœ…   â”‚
â”‚ Modifier formations       â”‚  âŒ  â”‚   âœ…    â”‚    âŒ     â”‚  âœ…   â”‚
â”‚ Valider formations        â”‚  âŒ  â”‚   âœ…    â”‚    âŒ     â”‚  âœ…   â”‚
â”‚ Supprimer formations      â”‚  âŒ  â”‚   âŒ    â”‚    âŒ     â”‚  âœ…   â”‚
â”‚ Voir rapports/statistiquesâ”‚  âŒ  â”‚   âŒ    â”‚    âœ…     â”‚  âœ…   â”‚
â”‚ GÃ©rer utilisateurs        â”‚  âŒ  â”‚   âŒ    â”‚    âŒ     â”‚  âœ…   â”‚
â”‚ GÃ©rer paramÃ¨tres systÃ¨me  â”‚  âŒ  â”‚   âŒ    â”‚    âŒ     â”‚  âœ…   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
3. FICHIERS DE CONFIGURATION
================================================================================

ğŸ“ src/Service/RoleService.php
   - Service principal de gestion des rÃ´les
   - Fonctions de vÃ©rification des permissions
   - Logique mÃ©tier centralisÃ©e

ğŸ“ src/Twig/RoleExtension.php
   - Extension Twig pour utiliser les fonctions dans les templates
   - Rend les fonctions disponibles partout dans l'application

ğŸ“ config/packages/security.yaml
   - Configuration de la hiÃ©rarchie des rÃ´les
   - Configuration de l'authentification

================================================================================
4. UTILISATION DANS LES TEMPLATES
================================================================================

Fonctions disponibles dans les templates Twig:

ğŸ”¹ VÃ©rification de rÃ´les:
   - {% if is_editeur() %} ... {% endif %}
   - {% if is_directeur() %} ... {% endif %}
   - {% if is_admin() %} ... {% endif %}

ğŸ”¹ VÃ©rification de permissions:
   - {% if can_create_formation() %} ... {% endif %}
   - {% if can_manage_users() %} ... {% endif %}
   - {% if can_view_reports() %} ... {% endif %}
   - {% if can_manage_settings() %} ... {% endif %}

Exemples dans templates/partials/sidebar.html.twig:
```twig
{# Section visible seulement pour les admins #}
{% if can_manage_settings() %}
    <div class="menu-item">
        <a href="{{ path('app_direction_index') }}">Directions</a>
    </div>
{% endif %}

{# Bouton visible seulement pour les Ã©diteurs et admins #}
{% if can_create_formation() %}
    <div class="menu-item">
        <a href="{{ path('app_formation_create') }}">Ajouter</a>
    </div>
{% endif %}
```

================================================================================
5. CONTRÃ”LE D'ACCÃˆS DANS LES CONTRÃ”LEURS
================================================================================

Annotations de sÃ©curitÃ© dans les contrÃ´leurs:

```php
// Seuls les Ã©diteurs et admins peuvent accÃ©der
#[Route('/create', name: 'app_formation_create')]
#[IsGranted('ROLE_EDITEUR')]
public function create(): Response

// Seuls les admins peuvent supprimer
#[Route('/{id}', name: 'app_formation_delete')]
#[IsGranted('ROLE_ADMIN')]
public function delete(Formation $formation): JsonResponse

// ContrÃ´leur entier rÃ©servÃ© aux admins
#[Route('/user')]
#[IsGranted('ROLE_ADMIN')]
class UserController extends AbstractController
```

================================================================================
6. COMMENT AJOUTER UN NOUVEAU RÃ”LE
================================================================================

Ã‰tape 1: Ajouter dans config/packages/security.yaml
```yaml
role_hierarchy:
    ROLE_SUPERVISEUR: ROLE_EDITEUR
```

Ã‰tape 2: Ajouter dans src/Service/RoleService.php
```php
public function isSuperviseur(): bool
{
    return $this->hasRole('ROLE_SUPERVISEUR');
}

public function canSupervise(): bool
{
    return $this->isSuperviseur() || $this->isAdmin();
}
```

Ã‰tape 3: Ajouter dans src/Twig/RoleExtension.php
```php
new TwigFunction('is_superviseur', [$this->roleService, 'isSuperviseur']),
new TwigFunction('can_supervise', [$this->roleService, 'canSupervise']),
```

Ã‰tape 4: Utiliser dans les templates
```twig
{% if is_superviseur() %}
    <!-- Contenu pour superviseurs -->
{% endif %}
```

================================================================================
7. EXEMPLES PRATIQUES
================================================================================

ğŸ”¹ Menu Sidebar (templates/partials/sidebar.html.twig):
   - Section "Gestion" â†’ Visible seulement pour les admins
   - Section "Formations" â†’ Bouton "Ajouter" visible pour Ã©diteurs et admins
   - Section "Rapports" â†’ Visible pour directeurs et admins

ğŸ”¹ Pages de dÃ©tail:
   - Bouton "Modifier" â†’ MasquÃ© si formation/mission dÃ©jÃ  validÃ©e
   - Bouton "GÃ©rer les rÃ´les" â†’ Visible seulement pour les admins

ğŸ”¹ ContrÃ´leurs:
   - FormationController â†’ CrÃ©ation/modification rÃ©servÃ©e aux Ã©diteurs
   - UserController â†’ EntiÃ¨rement rÃ©servÃ© aux admins
   - ReportingController â†’ RÃ©servÃ© aux directeurs et admins

================================================================================
8. FONCTIONS DISPONIBLES DANS RoleService
================================================================================

VÃ©rification de rÃ´les:
- hasRole(string $role): bool
- isEditeur(): bool
- isDirecteur(): bool
- isAdmin(): bool

Permissions formations:
- canCreateFormation(): bool
- canEditFormation(): bool
- canValidateFormation(): bool
- canDeleteFormation(): bool

Permissions systÃ¨me:
- canManageUsers(): bool
- canManageSettings(): bool
- canViewStatistics(): bool
- canViewReports(): bool
- canViewAdvancedFilters(): bool

Utilitaires:
- getCurrentUser(): ?User
- getHighestRole(): string
- requireRole(string $role): void
- requireCanCreateFormation(): void

================================================================================
9. SÃ‰CURITÃ‰ ET BONNES PRATIQUES
================================================================================

âœ… Points forts du systÃ¨me:
- ContrÃ´le d'accÃ¨s Ã  deux niveaux (contrÃ´leur + template)
- Logique centralisÃ©e dans RoleService
- HiÃ©rarchie automatique des rÃ´les
- Fonctions rÃ©utilisables dans les templates
- Code maintenable et extensible

âš ï¸ Points d'attention:
- Toujours vÃ©rifier les permissions cÃ´tÃ© serveur (contrÃ´leur)
- Ne pas se fier uniquement Ã  l'affichage cÃ´tÃ© client (template)
- Tester les permissions avec diffÃ©rents rÃ´les
- Documenter les nouveaux rÃ´les ajoutÃ©s

================================================================================
10. FLUX DE VÃ‰RIFICATION DES PERMISSIONS
================================================================================

1. Utilisateur accÃ¨de Ã  une page
   â†“
2. Symfony vÃ©rifie l'annotation #[IsGranted('ROLE_XXX')]
   â†“
3. Si autorisÃ© â†’ Page affichÃ©e
   â†“
4. Dans le template, {% if can_create_formation() %} vÃ©rifie les permissions
   â†“
5. RoleService.isEditeur() || RoleService.isAdmin() retourne true/false
   â†“
6. Ã‰lÃ©ment affichÃ© ou masquÃ© selon le rÃ©sultat

================================================================================
                                FIN DU DOCUMENT
================================================================================

Ce document explique le systÃ¨me de gestion des rÃ´les de l'application de suivi.
Pour toute question ou modification, consulter les fichiers sources mentionnÃ©s.

Date de crÃ©ation: $(date)
Version: 1.0
