{% extends 'base.html.twig' %}

{% block title %}{{ formation.titre }}{% endblock %}

{% block breadcrumb %}
<ul class="breadcrumb">
	<li class="breadcrumb-item"><a href="#">FORMATIONS</a></li>
	<li class="breadcrumb-item"><a href="{{ path('app_formation_modele_index') }}">Modèles</a></li>
	<li class="breadcrumb-item active">{{ formation.titre }}</li>
</ul>
{% endblock %}

{% block page_title %}
<h1 class="page-header">
	{{ formation.titre }} <small>Modèle de formation</small>
</h1>
{% endblock %}

{% block buttons %}
<div class="d-flex gap-2">
	<a href="{{ path('app_formation_modele_index') }}" class="btn btn-outline-secondary btn-sm">
		<i class="fa fa-arrow-left"></i> Retour à la liste
	</a>
	{% if can_create_formation() %}
	<a href="{{ path('app_formation_modele_edit', { id: formation.id }) }}" class="btn btn-warning btn-sm">
		<i class="fa fa-edit"></i> Modifier
	</a>
	<button type="button" class="btn btn-danger btn-sm" onclick="deleteFormationModele({{ formation.id }})">
		<i class="fa fa-trash"></i> Supprimer
	</button>
	<a href="{{ path('app_formation_create') }}" class="btn btn-secondary btn-sm">
		<i class="fa fa-calendar-plus"></i> Planifier une session
	</a>
	{% endif %}
</div>
{% endblock %}

{% block body %}
<div class="row">
	<div class="col-12">
		<div class="card mb-3">
			<div class="card-header">
				<h5 class="card-title mb-0"><i class="fa fa-info-circle"></i> Détails du modèle</h5>
			</div>
			<div class="card-body">
				<dl class="row mb-0">
					<dt class="col-sm-4">Titre</dt>
					<dd class="col-sm-8">{{ formation.titre }}</dd>

					<dt class="col-sm-4">Description</dt>
					<dd class="col-sm-8">{{ formation.description|default('Aucune description renseignée.') }}</dd>

					<dt class="col-sm-4">Créée le</dt>
					<dd class="col-sm-8">{{ formation.createdAt ? formation.createdAt|date('d/m/Y H:i') : '-' }}</dd>
				</dl>
			</div>
		</div>
	</div>
</div>
<div class="row">
	<div class="col-12">
		<div class="card mb-3">
			<div class="card-header d-flex justify-content-between align-items-center">
				<h5 class="card-title mb-0"><i class="fa fa-calendar"></i> Sessions associées</h5>
				{% if can_create_formation() %}
				<a href="{{ path('app_formation_create') }}" class="btn btn-outline-secondary btn-xs">
					<i class="fa fa-plus"></i> Nouvelle session
				</a>
				{% endif %}
			</div>
			<div class="card-body">
				{% if sessions is empty %}
					<p class="text-muted mb-0">Aucune session n'est encore planifiée pour ce modèle.</p>
				{% else %}
					<div class="table-responsive">
						<table class="table table-hover align-middle mb-0">
							<thead class="table-secondary">
								<tr>
									<th>Direction</th>
									<th>Dates prévues</th>
									<th>Durée</th>
									<th>Statut</th>
									<th class="text-end"></th>
								</tr>
							</thead>
							<tbody>
								{% for session in sessions %}
									<tr>
										<td>{{ session.direction ? session.direction.libelle : '-' }}</td>
										<td>
											{{ session.datePrevueDebut ? session.datePrevueDebut|date('d/m/Y') : '-' }}
											–
											{{ session.datePrevueFin ? session.datePrevueFin|date('d/m/Y') : '-' }}
										</td>
										<td>{{ session.dureePrevue }} jours</td>
										<td>
											<span class="badge bg-secondary">{{ session.statutActivite ? session.statutActivite.libelle : '-' }}</span>
										</td>
										<td class="text-end">
											<a href="{{ path('app_formation_session_show', { id: session.id }) }}" class="btn btn-outline-secondary btn-xs">
												<i class="fa fa-eye"></i> Voir
											</a>
										</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				{% endif %}
			</div>
		</div>
	</div>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
function deleteFormationModele(id) {
	if (!confirm('Confirmez-vous la suppression de ce modèle de formation ?')) {
		return;
	}

	const url = "{{ path('app_formation_modele_delete', { id: formation.id }) }}";

	fetch(url, {
		method: 'DELETE',
		headers: {
			'X-Requested-With': 'XMLHttpRequest'
		}
	})
	.then(response => response.json().then(data => ({ ok: response.ok, data })))
	.then(({ ok, data }) => {
		if (!ok) {
			throw new Error(data.message || 'La suppression a échoué.');
		}
		window.location.href = "{{ path('app_formation_modele_index') }}";
	})
	.catch(error => {
		console.error('Erreur de suppression du modèle de formation :', error);
		alert(error.message);
	});
}
</script>
{% endblock %}

